function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module&&"function"==typeof require?module.exports=e(require("jquery")):e(t.jQuery)}(this,function(i){"use strict";function e(t,e){return this.element=t,this.options=i.extend({},n,e),this.init()}var n={};e.prototype.init=function(){var a=this;return this.$element=i(this.element),this.$areasCount=this.$element.find('[data-component~="wcpw-thumbnail-generator-areas-count"]'),this.$areaSelect=this.$element.find('[data-component~="wcpw-thumbnail-generator-area-select"]'),this.$canvas=this.$element.find('[data-component~="wcpw-thumbnail-generator-canvas"]'),this.ajaxUrl=this.$canvas.data("ajax-url")||"/wp-admin/admin-ajax.php",this.canvasSize={width:this.$canvas.width(),height:this.$canvas.height()},this.resizableSettings={containment:'[data-component~="wcpw-thumbnail-generator-canvas"]',snap:!0,snapTolerance:10,handles:"all",resize:function(t,e){var n=i(this).closest('[data-component~="wcpw-thumbnail-generator-area"]');n.find('[data-component~="wcpw-thumbnail-generator-area-width"]').val(e.size.width),n.find('[data-component~="wcpw-thumbnail-generator-area-height"]').val(e.size.height),t.preventDefault()}},this.draggableSettings={containment:'[data-component~="wcpw-thumbnail-generator-canvas"]',snap:!0,snapTolerance:10,drag:function(t,e){var n=i(this).closest('[data-component~="wcpw-thumbnail-generator-area"]');n.find('[data-component~="wcpw-thumbnail-generator-area-y"]').val(e.position.top),n.find('[data-component~="wcpw-thumbnail-generator-area-x"]').val(e.position.left)}},this.initUIHelpers(),this.$element.on("change","#_thumbnail_canvas_width",function(){return a.setCanvasSize({width:i(this).val()})}).on("change","#_thumbnail_canvas_height",function(){return a.setCanvasSize({height:i(this).val()})}).on("click",'[data-component~="wcpw-thumbnail-generator-clear"]',function(t){return t.preventDefault(),a.clearCanvas()}).on("click",'[data-component~="wcpw-thumbnail-generator-area-add"]',function(t){return t.preventDefault(),a.addArea()}).on("click",'[data-component~="wcpw-thumbnail-generator-area-clone"]',function(){return a.cloneArea(i(this).closest('[data-component~="wcpw-thumbnail-generator-area"]'))}).on("click",'[data-component~="wcpw-thumbnail-generator-area-remove"]',function(){return a.removeArea(i(this).closest('[data-component~="wcpw-thumbnail-generator-area"]'))}).on("change",'[data-component~="wcpw-thumbnail-generator-area-x"]',function(){var t=i(this),e=t.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),n=Number(t.val());return n+e.width()>a.canvasSize.width&&(n=a.canvasSize.width-e.width(),setTimeout(function(){return t.val(n)},0)),a.setAreaProperty(e,{left:n})}).on("change",'[data-component~="wcpw-thumbnail-generator-area-y"]',function(){var t=i(this),e=t.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),n=Number(t.val());return n+e.height()>a.canvasSize.height&&(n=a.canvasSize.height-e.height(),setTimeout(function(){return t.val(n)},0)),a.setAreaProperty(e,{top:n})}).on("change",'[data-component~="wcpw-thumbnail-generator-area-width"]',function(){var t=i(this),e=t.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),n=Number(t.val());return n+e.position().left>a.canvasSize.width&&(n=a.canvasSize.width-e.position().left,setTimeout(function(){return t.val(n)},0)),a.setAreaProperty(e,{width:n})}).on("change",'[data-component~="wcpw-thumbnail-generator-area-height"]',function(){var t=i(this),e=t.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),n=Number(t.val());return n+e.position().top>a.canvasSize.height&&(n=a.canvasSize.height-e.position().top,setTimeout(function(){return t.val(n)},0)),a.setAreaProperty(e,{height:n})}).on("click",'[data-component~="wcpw-thumbnail-generator-area-move"]',function(t){t.preventDefault();var e=i(this),n=e.closest('[data-component~="wcpw-thumbnail-generator-area"]');return a.changeAreaOrder(n,e.data("direction"))}),this},e.prototype.initUIHelpers=function(){var t=this.$element.find('[data-component~="wcpw-thumbnail-generator-area-inner"]');return i.fn.draggable&&t.draggable(this.draggableSettings),i.fn.resizable&&t.resizable(this.resizableSettings),this},e.prototype.recalculateIds=function(){return this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').each(function(e){var t=i(this);return t.find('[data-component~="wcpw-thumbnail-generator-area-index"]').val(e),t.find(":input").each(function(){var t=i(this).attr("name");return t?i(this).attr("name",t.replace(/\[\d+]/g,"[".concat(e,"]"))):this})}),this},e.prototype.setCanvasSize=function(t){var e={};return void 0!==t.width&&(this.canvasSize.width=t.width,e.width=t.width+"px"),void 0!==t.height&&(this.canvasSize.height=t.height,e.height=t.height+"px"),this.$canvas.css(e),this},e.prototype.clearCanvas=function(){return this.$canvas.html(""),this.recalculateAreasCount()},e.prototype.addArea=function(){var e=this,t={action:"wcpwGetThumbnailGeneratorAreaView",id:this.$areaSelect.val(),type:this.$areaSelect.find(":selected").parent().data("type"),index:this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').length};return i.post(this.ajaxUrl,t,function(t){e.$canvas.append(t.html),e.recalculateAreasCount().recalculateIds().initUIHelpers(),i(document).trigger("added.area.thumbnailGenerator.wcpw",[e,t])},"json")},e.prototype.cloneArea=function(t){var e=t.clone(),n=e.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]'),a=e.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal-open"]'),r=~~(1e6*Math.random());return n.attr("id","wcpw-thumbnail-generator-area-settings-modal-".concat(r.toString())),a.attr("href","#wcpw-thumbnail-generator-area-settings-modal-".concat(r.toString())),e.find(".ui-resizable-handle").remove(),e.insertAfter(t),this.recalculateAreasCount().recalculateIds().initUIHelpers(),i(document).trigger("cloned.area.thumbnailGenerator.wcpw",[this,e]),this},e.prototype.removeArea=function(t){return t.remove(),this.recalculateAreasCount().recalculateIds(),i(document).trigger("removed.area.thumbnailGenerator.wcpw",[this]),this},e.prototype.setAreaProperty=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a={},r=t.height(),i=t.width(),o=t.position();return void 0!==e.top&&(n||e.top+r<=this.canvasSize.height&&!n)&&(a.top=e.top+"px"),void 0!==e.left&&(n||e.left+i<=this.canvasSize.width&&!n)&&(a.left=e.left+"px"),void 0!==e.width&&(n||e.width+o.left<=this.canvasSize.width&&!n)&&(a.width=e.width+"px"),void 0!==e.height&&(n||e.height+o.top<=this.canvasSize.height&&!n)&&(a.height=e.height+"px"),t.css(a),this},e.prototype.changeAreaOrder=function(t,e){switch(e){default:case"up":0<t.prev().length&&t.prev().insertAfter(t);break;case"down":0<t.next().length&&t.next().insertBefore(t)}return this.recalculateIds()},e.prototype.recalculateAreasCount=function(){return this.$areasCount.text(this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').length),this},i.fn.wcpwThumbnailGenerator=function(t){return this.each(function(){i.data(this,"wcpw-thumbnail-generator")||i.data(this,"wcpw-thumbnail-generator",new e(this,t))})};function t(){return i('[data-component~="wcpw-thumbnail-generator-canvas"]').each(function(){return i(this).closest('[data-component~="wcpw-settings-group-content"]').wcpwThumbnailGenerator()})}i(document).ready(t).on("init.thumbnailGenerator.wcpw",t)});